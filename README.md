# Курс "Микропроцессорные устройства"

Кафедра [Промышленная электроника](https://mpei.ru/Structure/Universe/ire/structure/ie/Pages/default.aspx) [НИУ МЭИ](https://mpei.ru/).

![ ](img/mpei_logo.jpg) ![ ](img/logo_ie.jpg)

## Оглавление

- [Курс "Микропроцессорные устройства"](#курс-микропроцессорные-устройства)
  - [Оглавление](#оглавление)
  - [Преподаватели](#преподаватели)
  - [Обзор курса](#обзор-курса)
  - [Цели](#цели)
  - [Предварительные требования](#предварительные-требования)
  - [Структура курса](#структура-курса)
    - [Часть 1 Основы микропроцессорной техники](#часть-1-основы-микропроцессорной-техники)
    - [Часть 2 Микроконтроллер и периферийные модули](#часть-2-микроконтроллер-и-периферийные-модули)
    - [Лекции](#лекции)
    - [Практические занятия](#практические-занятия)
    - [Лабораторные работы](#лабораторные-работы)
    - [Зачет и экзамен](#зачет-и-экзамен)
  - [Материалы курса](#материалы-курса)
    - [Клонирование репозитория](#клонирование-репозитория)
    - [Загрузка репозитория в виде zip архива](#загрузка-репозитория-в-виде-zip-архива)
  - [Перечень директорий репозитория](#перечень-директорий-репозитория)
  - [Литература](#литература)
  - [Полезные ссылки](#полезные-ссылки)
  - [Учебный стенд](#учебный-стенд)
  - [Установка и настройка инструментов разработки](#установка-и-настройка-инструментов-разработки)
    - [Keil uVision5](#keil-uvision5)
      - [Создание нового проекта для языка Ассемблер в Keil uVision5](#создание-нового-проекта-для-языка-ассемблер-в-keil-uvision5)
      - [Создание нового проекта для языка C в Keil uVision5](#создание-нового-проекта-для-языка-c-в-keil-uvision5)
      - [Настройка подключения ST-Link в Keil uVision5](#настройка-подключения-st-link-в-keil-uvision5)
      - [Настройка симулятора](#настройка-симулятора)
      - [Работа в отладчике](#работа-в-отладчике)
      - [Исправление ошибки загрузки программы в Keil uVision5](#исправление-ошибки-загрузки-программы-в-keil-uvision5)
    - [vscode gcc](#vscode-gcc)
      - [Windows](#windows)
      - [Linux](#linux)
      - [MacOS](#macos)
      - [Текстовый редактор vscode](#текстовый-редактор-vscode)
  - [Ошибки и опечатки](#ошибки-и-опечатки)

## Преподаватели

Александр Николаевич Смирнов

Электронная почта: [smirnovalnik@mpei.ru](mailto:smirnovalnik@mpei.ru)

Практические занятия и лабораторные работы проводятся преподавателями выпускающих кафедр.

## Обзор курса

Курс предначен для студентов бакалавриата четвертого года обучения факультета электронной техники.
Курс знакомит с основами микропроцессорной техники, программированию микроконтроллеров на языке Ассемблер и C.

## Предварительные требования

Студент должен обладать навыками программирования на хотя бы одном языке высокого уровня,
знать основы аналоговой и цифровой схемотехники.

## Структура курса

Курс состоит из двух частей: осенний семестр (часть 1) и весенний семестр (часть 2).

## Цели

Цели первой части курса:

- изучение принципов построения микропроцессорных устройств;
- изучение языка программирования Ассемблер и его применения для встраиваемых микропроцессорных систем.

Цели второй части курса:

- изучение периферийных модулей микроконтроллеров на примере _STM32F072RBT6_;
- изучение языка программирования C и его применения для встраиваемых микропроцессорных систем.

### Часть 1 Основы микропроцессорной техники

- Лекции
  - Лекция №1: Принципы организации цифровых систем управления и преобразования цифровых сигналов
  - Лекция №2: Структура микропроцессорной системы
  - Лекция №3: Память в микропроцессорной системе
  - Лекция №4: Память в микропроцессорной системе
  - Лекция №5: Устройства ввода/вывода
  - Лекция №6: Система команд центрального процессора
  - Лекция №7: Система команд центрального процессора
  - Лекция №8: Структура центрального процессора
  - Лекция №9: Структура центрального процессора
  - Лекция №10: Структура центрального процессора
  - Лекция №11: Карта памяти и селектор адреса
  - Лекция №12: Исключения и прерывания
  - Лекция №13: Прямой доступ к памяти
  - Лекция №14: Модульный принцип построения микроконтроллера
  - Лекция №15: Системные модули микроконтроллера
  - Лекция №16: Подсистема тактирования микроконтроллера
- Практические занятия
  - Практическое занятие №1: Команды загрузки данных ([пример](./examples/part1/workshop/ex1/))
  - Практическое занятие №2: Команды обработки данных ([пример](./examples/part1/workshop/ex2/))
  - Практическое занятие №3: Команды ветвления ([пример](./examples/part1/workshop/ex3/))
  - Практическое занятие №4: Команды вызова подпрограмм ([пример](./examples/part1/workshop/ex4/))
  - Практическое занятие №5: Поиск наибольшего элемента в массиве ([пример](./examples/part1/workshop/ex5/))
  - Практическое занятие №6: Сортировка массива ([пример](./examples/part1/workshop/ex6/))
  - Практическое занятие №7: Порт ввода/вывода общего назначения ([пример](./examples/part1/workshop/ex7/))
  - Практическое занятие №8: Мигающий светодиод ([пример](./examples/part1/workshop/ex8/))
- Лабораторные работы
  - Лабораторная работа №1: Команды обработки данных и загрузки данных ([пример](./examples/part1/labs/lab1/))
  - Лабораторная работа №2: Поиск элеметов в массиве данных ([пример](./examples/part1/labs/lab2/))
  - Лабораторная работа №3: Обработка массива данных ([пример](./examples/part1/labs/lab3/))
  - Лабораторная работа №4: Логическая функция ([пример](./examples/part1/labs/lab4/))
- Зачет с оценкой

### Часть 2 Микроконтроллер и периферийные модули

- Лекции
  - Лекция №1: Микроконтроллер
  - Лекция №2: Порты ввода/вывода общего назначения
  - Лекция №3: Подсистема прерываний
  - Лекция №4: Аналоговый ввод/вывод
  - Лекция №5: Таймер-счетчик общего назначения
  - Лекция №6: Каналы выходного сравнения таймера-счетчика
  - Лекция №7: Каналы входного захвата таймера-счетчика
  - Лекция №8: Последовательный ввод/вывод: UART
  - Лекция №9: Последовательный ввод/вывод: SPI
  - Лекция №10: Последовательный ввод/вывод: I2C
  - Лекция №11: Последовательный ввод/вывод: CAN
  - Лекция №12: Контроллер прямого доступа к памяти
  - Лекция №13: Подсистема тактирования
- Практические занятия
  - Практическое занятие №1: Язык программирования C ([пример](./examples/part2/workshop/ex1))
  - Практическое занятие №2: Порты ввода/вывода МК ([пример](./examples/part2/workshop/ex2))
  - Практическое занятие №3: Подсистема аналогового ввода/вывода МК ([пример](./examples/part2/workshop/ex3))
  - Практическое занятие №4: Подсистема прерываний МК ([пример](./examples/part2/workshop/ex4))
  - Практическое занятие №5: Подсистема реального времени МК: "бегущий огонь" ([пример](./examples/part2/workshop/ex5))
  - Практическое занятие №6: Подсистема реального времени МК: регулирование яркости ([пример](./examples/part2/workshop/ex6))
  - Практическое занятие №7: Подсистема последовательного ввода/вывода МК: UART ([пример](./examples/part2/workshop/ex7))
  - Дополнительное практическое занятие №1: Подсистема последовательного ввода/вывода МК: I2C ([пример](./examples/part2/workshop/opt_ex1))
  - Дополнительное практическое занятие №2: Подсистема последовательного ввода/вывода МК: SPI ([пример](./examples/part2/workshop/opt_ex2))
- Лабораторные работы
  - Лабораторная работа №1: Язык программирования C ([пример](./examples/part2/labs/lab1/))
  - Лабораторная работа №2: Подсистема аналогового ввода/вывода МК ([пример](./examples/part2/labs/lab2/))
  - Лабораторная работа №3: Подсистема реального времени МК ([пример](./examples/part2/labs/lab3/))
  - Лабораторная работа №4: Подсистема последовательного ввода/вывода МК: UART ([пример](./examples/part2/labs/lab4/))
- Экзамен

### Лекции

На лекциях изучаются теоретические вопросы работы микропроцессорных систем, периферийных модулей, а также некоторые практические вопросы по программированию этих систем.

### Практические занятия

Практические занятия проводятся преподавателями выпускающих кафедр.
Порядок проведения занятий, темы занятий и их содержание могут отличаться от приведенного здесь.

### Лабораторные работы

Лабораторные работы проводятся преподавателями выпускающих кафедр.
Порядок проведения занятий, темы занятий и их содержание могут отличаться от приведенного здесь.

Выполнение лабораторных работ предполагает предварительную самостоятельную подготовку:
изучение примеров, создание проекта и написание исходных текстов программы.

Лабораторные работы №1, №2, №3 первой части и №1 второй части могут быть выполнены на симуляторе.
Остальные работы выполняются на учебном стенде.

### Зачет и экзамен

Первая часть курса заканчивается зачетом с оценкой, вторая - экзаменом.

## Материалы курса

Материалы курса размещены на сайте [GitHub](https://github.com),
который является большим хранилищем программ (исходных текстов)
под управлением системы контроля версий `git`.

Репозиторий непрерывно обновляется и поэтому рекомендуется периодически ["подтягивать"](#обновление-репозитория) обновления.

Если вы не знакомы с `git`, то можете [скачивать архив](#загрузка-репозитория-в-виде-zip-архива) проекта.

### Клонирование репозитория

```bash
git clone https://github.com/smirnovalnik/microprocessor-units-course.git
```

### Обновление репозитория

```bash
cd ./microprocessor-units-course # перейти в директорию с репозиторием
git reset --hard # если вы меняли файлы, то необходимо "сбросить" репозиторий
git pull # "подтянуть" обновления
```

### Загрузка репозитория в виде zip архива

![ ](./img/github_download.gif)

## Перечень директорий репозитория

- [docs](./docs/) - различная документация
- [exam](./exam/) - вопросы к зачету и экзамену, примеры билетов
- [examples](./examples/) - примеры лабораторных работ и задачи для практических занятий
- [hardware](./hardware/) - исходные файлы проекта _Учебный стенд_ в Altium Designer
- [img](./img/) - различные картинки используемые в README файлах
- [lectures](./lectures/) - слайды и тексты программ лекций
- [programs](./programs/) - программы для установки на ПК
- [tests](./tests/) - проекты для тестирования _Учебного стенда_
- [templates](./templates/) - шаблоны проектов

## Литература

- _Харрис Сара Л., Харрис Дэвид М. "Цифровая схемотехника и архитектура компьютера: RISC-V"_
- _Харрис Сара Л., Харрис Дэвид М. "Цифровая схемотехника и архитектура компьютера. Дополнение по архитектуре ARM"_
- _Угрюмов Е. П. "Цифровая схемотехника"_
- _Joseph Yiu "The Definitive Guide to ARM Cortex-M0 and Cortex-M0+ Processors 2nd Edition"_
- _Козаченко В.Ф., Алямкин Д.И., Анучин А.С., Жарков А.А., Лашкевич М.М., Савкин Д.И., Шпак Д.М. "Практический курс микропроцессорной техники на базе процессорных ядер ARM-Cortex-M3/M4/M4F"_
- Для обучения программированию на языке C обязательна к прочтению и **решению всех упражнений** книга
_Керниган Б., Ритчи Д. "Язык программирования C" 2-е издание._

## Полезные ссылки

- [Страница по stm32072rb от производителя](https://www.st.com/en/microcontrollers-microprocessors/stm32f072rb.html)
- [Страница по stm32f072-disco от производителя](https://www.st.com/en/evaluation-tools/32f072bdiscovery.html)
- [SoC 101](https://www.eng.biu.ac.il/temanad/soc-101/)

## Учебный стенд

Стенд состоит из нескольких плат с электронными компонентами: отладочная плата _STM32F072B-DISCO_, основная плата, ЖК индикатор, модуль беспроводной передачи данных.

Основная плата содержит исполнительные устройства и устройства ввода для микроконтроллера. Основная плата разработана на кафедре Промышленной Электроники НИУ МЭИ.

Отладочная плата _STM32F072B-DISCO_ содержит изучаемый МК _STM32F072RBT6_, а также программатор _ST-LINK/V2_. Программатор позволяет загружать код программы, который подготовлен на персональном компьютере в постоянную память МК и затем наблюдать на экране монитора за исполнением этой программы.

Плата _STM32F072RBT6_ содержит небольшое количество устройств ввода и вывода. Основная плата расширяет возможности по вводу и выводу, что позволяет создать множество различных учебных заданий, используя индикаторы и всевозможные кнопки и переключателями.

![ ](img/learning_stand.png)

1. Отладочная плата _STM32F072B-DISCO_
2. Цифро-буквенный ЖК индикатор со встроенным контроллером
3. Переключатели для смены периферийных устройств
4. Выходы ЦАП с разъемом BNC
5. Вход АЦП по SPI с разъемом BNC
6. Вход АЦП с разъемом BNC
7. 16 RGB светодиодов (D1-D16)
8. Переключатели для выбора канала АЦП между входами BNC и потенциометрами POT1, POT2
9. Потенциометры (POT1 и POT2)
10. Клавиатура, состоящая из 16 тактовых кнопок без фиксации
11. Тактовые кнопки без фиксации (SB1-SB4)
12. Переключатели (SW1-SW4)
13. 4-х разрядный семисегментный индикатор
14. Разъем для SD карты
15. Разъем CAN
16. Разъем USB-UART
17. Разъем питания
18. Модуль передачи данных (ZigBee, Wi-Fi, Bluetooth)

## Установка и настройка инструментов разработки

### Keil uVision5

Разработка программ для микроконтроллера проводится
в интегрированной среде разработки (IDE - Integrated Development Environment)
[Keil MDK Lite Edition](http://www2.keil.com/mdk5/editions/lite).
Для загрузки среды требуется регистрация на сайте Keil.
Процесс установки ничем не отличается от установки любой другой программы для Windows.

> :bulb: **Примечание:** Избегайте русскоязычных названий директорий как в пути установки программы, так и в путях к вашим проектах. Некоторые компоненты среды разработки могут работать некорректно.

Эта версия обладает практически полной функциональностью профессиональной версии,
но с ограничением размера скомпилированной программы в 32 кБайта.
Для лабораторных работ и практических занятий данного курса этого более чем достаточно.

В `Keil MDK Lite Edition` есть симулятор, поэтому работу программы
можно проверить без учебного стенда. Однако данный симулятор поддерживает
только центральный процессор, но не периферийные модули микроконтроллера.

Keil MDK Lite Edition изначально ничего не знает о микроконтроллерах
фирмы ST. Поэтому потребуется скачать и установить пакет с библиотеками для `stm32f0` по ссылке
[Keil.STM32F0xx_DFP.2.1.0.pack](./programs/Keil.STM32F0xx_DFP.2.1.0.pack).

#### Создание нового проекта для языка Ассемблер в Keil uVision5

![ ](./img/uvision_project_creation_asm.gif)

#### Создание нового проекта для языка C в Keil uVision5

![ ](./img/uvision_project_creation_c.gif)

#### Настройка подключения ST-Link в Keil uVision5

![ ](./img/uvision_stlink_debug.gif)

#### Настройка симулятора

![ ](./img/uvision_simulator.gif)

#### Работа в отладчике

![ ](./img/uvision_debug.gif)

#### Исправление ошибки загрузки программы в Keil uVision5

![ ](./img/uvision_flash.gif)

### vscode и gcc

Разрабатывать программы также можно в редакторе кода с наборов инструментов `gcc`.

Скачать шаблон проекта для `gcc` и `vscode` с подробным описанием можно по [ссылке](https://github.com/smirnovalnik/stm32f072-vscode-gcc-template).

> :bulb: **Примечание:** Использование инструментов `gcc` и `vscode` не обязательно. Все примеры практических задач и лабораторных работ сопровождаются проектом для `Keil uVision5`.

## Ошибки и опечатки

Если вы нашли ошибки или опечатки просьба сообщать о них через [issues](https://github.com/smirnovalnik/microprocessor-units-course/issues) в `GitHub` или писать на почту [smirnovalnik@mpei.ru](mailto:smirnovalnik@mpei.ru).

Если вы хотите улучшить содержание репозитория, то можете создать `pull request` на добавление ваших изменений.
